#! /bin/sh

if [ "$#" -ne 1 ]; then
    echo -e "Usage: `basename "$0"` <file path with md5 list>\n"
    exit 0
fi

#The script will grab the reports associated with the following MD5 list
md5list=$(cat $1)

for md5 in $md5list; do
    echo -e "Creating report for $md5\n"
    url="https://virustotal.com/en/search?query=$md5" 
    result=""
    while true; do
        result=$(lynx -dump "$url"| egrep "[^ ][^ ]*  *[^ ][^ ]*  *[0-9]{8}$")
        if [ -z "$result" ]; then #if result is empty, this means that VirusTotal is asking for captcha
            echo -e "Please browse to $url and resolve the captcha. Then press any key to continue..\n"
            read -n1 -s
            echo -e "Resuming...\n"
        else
            break
        fi
    done
    echo "$result" > "$md5.report"
done

echo -e "Done!\n"
